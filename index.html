<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaseReport - CATTO</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>CaseReport - CATTO</h1>
            <p class="subtitle">Anesthesia Case Report Screening AI</p>
        </header>

        <!-- API Key Section -->
        <section class="glass-panel" id="apiKeySection">
            <h3>ğŸ”‘ Gemini API Key</h3>
            <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem;">
                ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€Google Gemini APIã‚­ãƒ¼ãŒå¿…è¦ã§ã™ã€‚
                <a href="https://aistudio.google.com/apikey" target="_blank"
                    style="color: var(--secondary);">ã“ã¡ã‚‰</a>ã‹ã‚‰å–å¾—ã§ãã¾ã™ã€‚
            </p>
            <div style="display: flex; gap: 1rem; align-items: flex-end;">
                <div style="flex: 1;">
                    <label for="apiKeyInput">APIã‚­ãƒ¼ã‚’å…¥åŠ›</label>
                    <input type="password" id="apiKeyInput" placeholder="AIzaSy...">
                </div>
                <button onclick="saveApiKey()" class="btn btn-primary">ä¿å­˜</button>
            </div>
            <p id="apiKeyStatus" style="margin-top: 0.5rem; font-size: 0.85rem;"></p>
        </section>

        <section class="glass-panel" id="formSection" style="display:none;">
            <form id="cattoForm" class="grid">

                <!-- Email -->
                <div class="form-section">
                    <label for="submitter_email">Your Email (for Report)</label>
                    <input type="email" id="submitter_email" name="submitter_email"
                        placeholder="e.g. doctor@hospital.com" required>
                </div>

                <!-- A. Main Event -->
                <div>
                    <label for="main_event_1line">A. Main Event (1 line description)</label>
                    <input type="text" id="main_event_1line" name="main_event_1line"
                        placeholder="e.g. Rupture of left Valsalva sinus immediately after CPB..." required>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="condition_event">B. Condition / Event</label>
                        <input type="text" id="condition_event" name="condition_event"
                            placeholder="Medical term & synonyms" required>
                    </div>
                    <div>
                        <label for="anatomy">C. Anatomy</label>
                        <input type="text" id="anatomy" name="anatomy" placeholder="Site, Side, Related structures"
                            required>
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="trigger_exposure">D. Trigger / Exposure</label>
                        <input type="text" id="trigger_exposure" name="trigger_exposure"
                            placeholder="Procedure, Drug, Device" required>
                    </div>
                    <div>
                        <label for="timing">E. Timing</label>
                        <input type="text" id="timing" name="timing" placeholder="Intra-op phase, Post-op day X"
                            required>
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="host_factors">F. Host Factors</label>
                        <textarea id="host_factors" name="host_factors" rows="3"
                            placeholder="Age, Comorbidities, Genetics..."></textarea>
                    </div>
                    <div>
                        <label for="key_findings">G. Key Findings</label>
                        <textarea id="key_findings" name="key_findings" rows="3"
                            placeholder="Imaging, Pathology, Labs..."></textarea>
                    </div>
                </div>

                <div>
                    <label for="management_outcome">H. Management / Outcome</label>
                    <textarea id="management_outcome" name="management_outcome" rows="2"
                        placeholder="Intervention & Outcome"></textarea>
                </div>

                <div>
                    <label for="novelty_differences">I. Novelty / Differences</label>
                    <textarea id="novelty_differences" name="novelty_differences" rows="3"
                        placeholder="Why is this new?" required></textarea>
                </div>

                <div class="submit-section">
                    <button type="submit" class="btn btn-primary" id="analyzeBtn">
                        <span id="btnText">Analyze & Send Report</span>
                        <span id="spinner" class="loading-spinner" style="display:none;"></span>
                    </button>

                    <div class="info-box">
                        <p><strong>Novelty scoreï¼ˆ0â€“100ï¼‰ã¯ã€æœ€ã‚‚ä¸€è‡´åº¦ã®é«˜ã„æ—¢å ±ã® CATTO Level ã«åŸºã¥ã„ã¦ç®—å‡ºã—ã¾ã—ãŸï¼š</strong></p>
                        <ul>
                            <li>â€¢ Level 4 æ—¢å ±å¤šã„ â†’ â‰¤20%</li>
                            <li>â€¢ Level 3 ã‚„ã‚„æ—¢å ±ã‚ã‚Š(ã•ã‚‰ãªã‚‹å·®ã‚’è¦‹ã¤ã‘ã‚‹) â†’ 30â€“50%</li>
                            <li>â€¢ Level 2 å°‘ã—ã®æ—¢å ±ã®ã¿(ç—‡ä¾‹å ±å‘Šã„ã‘ã‚‹ã‹ã‚‚) â†’ 60â€“80%</li>
                            <li>â€¢ Level 1 ã®ã¿ï¼æœªä¸€è‡´(è«–æ–‡ã¾ã§ã„ã‘ãã†) â†’ â‰¥85%</li>
                        </ul>
                    </div>
                </div>

            </form>
        </section>

        <section id="results" class="glass-panel" style="display:none; margin-top: 2rem;">
            <h2 style="text-align: center;">
                Novelty Score: <span id="scoreValue" style="color: var(--secondary);">--</span>%
            </h2>
            <div style="text-align: center; margin-bottom: 1rem;">
                <span id="judgementBadge" class="badge">-- Priority</span>
            </div>

            <details class="info-box" style="margin-bottom: 1rem;">
                <summary style="cursor: pointer; font-weight: bold;">Step 1: Reconstructed CATTO</summary>
                <pre id="reconstructedCatto"
                    style="white-space: pre-wrap; font-size: 0.85rem; margin-top: 0.5rem;"></pre>
            </details>

            <details class="info-box" style="margin-bottom: 1rem;">
                <summary style="cursor: pointer; font-weight: bold;">Step 2: Search Core</summary>
                <pre id="searchCore" style="white-space: pre-wrap; font-size: 0.85rem; margin-top: 0.5rem;"></pre>
            </details>

            <div id="resultContent"></div>
        </section>
    </div>

    <script type="module" src="app.js"></script>
</body>

</html>