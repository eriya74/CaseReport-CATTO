<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CaseReport - CATTO</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>CaseReport - CATTO</h1>
            <p class="subtitle">Anesthesia Case Report Screening AI</p>
        </header>

        <section class="glass-panel">
            <form id="cattoForm" class="grid">

                <!-- Email -->
                <div class="form-section">
                    <label for="submitter_email">Your Email (for Report)</label>
                    <input type="email" id="submitter_email" name="submitter_email"
                        placeholder="e.g. doctor@hospital.com" required>
                </div>

                <!-- A. Main Event -->
                <div>
                    <label for="main_event_1line">A. Main Event (1 line description)</label>
                    <input type="text" id="main_event_1line" name="main_event_1line"
                        placeholder="e.g. Rupture of left Valsalva sinus immediately after CPB..." required>
                </div>

                <div class="grid-2">
                    <!-- B. Condition -->
                    <div>
                        <label for="condition_event">B. Condition / Event</label>
                        <input type="text" id="condition_event" name="condition_event"
                            placeholder="Medical term & synonyms" required>
                    </div>

                    <!-- C. Anatomy -->
                    <div>
                        <label for="anatomy">C. Anatomy</label>
                        <input type="text" id="anatomy" name="anatomy" placeholder="Site, Side, Related structures"
                            required>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- D. Trigger -->
                    <div>
                        <label for="trigger_exposure">D. Trigger / Exposure</label>
                        <input type="text" id="trigger_exposure" name="trigger_exposure"
                            placeholder="Procedure, Drug, Device" required>
                    </div>

                    <!-- E. Timing -->
                    <div>
                        <label for="timing">E. Timing</label>
                        <input type="text" id="timing" name="timing" placeholder="Intra-op phase, Post-op day X"
                            required>
                    </div>
                </div>

                <div class="grid-2">
                    <!-- F. Host Factors -->
                    <div>
                        <label for="host_factors">F. Host Factors</label>
                        <textarea id="host_factors" name="host_factors" rows="3"
                            placeholder="Age, Comorbidities, Genetics..."></textarea>
                    </div>

                    <!-- G. Key Findings -->
                    <div>
                        <label for="key_findings">G. Key Findings</label>
                        <textarea id="key_findings" name="key_findings" rows="3"
                            placeholder="Imaging, Pathology, Labs..."></textarea>
                    </div>
                </div>

                <!-- H. Management -->
                <div>
                    <label for="management_outcome">H. Management / Outcome</label>
                    <textarea id="management_outcome" name="management_outcome" rows="2"
                        placeholder="Intervention & Outcome"></textarea>
                </div>

                <!-- I. Novelty -->
                <div>
                    <label for="novelty_differences">I. Novelty / Differences</label>
                    <textarea id="novelty_differences" name="novelty_differences" rows="3"
                        placeholder="Why is this new?" required></textarea>
                </div>

                <div class="submit-section">
                    <button type="submit" class="btn btn-primary">
                        <span id="btnText">Analyze & Send Report</span>
                        <span id="spinner" class="loading-spinner" style="display:none;"></span>
                    </button>

                    <div class="info-box">
                        <p><strong>Novelty score（0–100）は、最も一致度の高い既報の CATTO Level に基づいて算出しました：</strong></p>
                        <ul>
                            <li>• Level 4 既報多い → ≤20%</li>
                            <li>• Level 3 やや既報あり(さらなる差を見つける) → 30–50%</li>
                            <li>• Level 2 少しの既報のみ(症例報告いけるかも) → 60–80%</li>
                            <li>• Level 1 のみ／未一致(論文までいけそう) → ≥85%</li>
                        </ul>
                    </div>

                    <div id="serverNote" class="warning-box">
                        <p><strong>⚠️ Note:</strong> This is a static demo. For full analysis functionality (PubMed
                            search, AI evaluation), please run the application locally with <code>npm run dev</code>.
                        </p>
                    </div>
                </div>

            </form>
        </section>

        <section id="results" class="glass-panel" style="display:none; margin-top: 2rem;">
            <h2 style="text-align: center;">
                Novelty Score: <span id="scoreValue" style="color: var(--secondary);">--</span>%
            </h2>
            <div style="text-align: center; margin-bottom: 1rem;">
                <span id="judgementBadge" class="badge">-- Priority</span>
            </div>
            <div id="resultContent"></div>
        </section>
    </div>

    <script>
        document.getElementById('cattoForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const btn = document.querySelector('.btn-primary');
            const btnText = document.getElementById('btnText');
            const spinner = document.getElementById('spinner');
            const results = document.getElementById('results');

            // Show loading state
            btnText.textContent = 'Analyzing...';
            spinner.style.display = 'inline-block';
            btn.disabled = true;

            // Simulate analysis (since we don't have a backend on GitHub Pages)
            setTimeout(() => {
                // Show demo results
                document.getElementById('scoreValue').textContent = '75';
                document.getElementById('judgementBadge').textContent = 'Moderate Priority';
                document.getElementById('judgementBadge').style.background = 'rgba(251, 191, 36, 0.2)';
                document.getElementById('judgementBadge').style.color = '#fbbf24';

                document.getElementById('resultContent').innerHTML = `
                    <div style="margin-bottom: 1.5rem;">
                        <h3>Analysis (Demo)</h3>
                        <p>This is a demonstration. For real analysis with PubMed search and AI evaluation, please run the full application locally.</p>
                    </div>
                    <div class="info-box">
                        <h4>To use the full application:</h4>
                        <ol style="margin-left: 1.5rem;">
                            <li>Clone the repository: <code>git clone https://github.com/eriya74/CaseReport-CATTO.git</code></li>
                            <li>Install dependencies: <code>npm install</code></li>
                            <li>Set up your API keys in <code>.env.local</code></li>
                            <li>Run: <code>npm run dev</code></li>
                            <li>Open: <code>http://localhost:3000</code></li>
                        </ol>
                    </div>
                `;

                results.style.display = 'block';
                results.scrollIntoView({ behavior: 'smooth' });

                // Reset button
                btnText.textContent = 'Analyze & Send Report';
                spinner.style.display = 'none';
                btn.disabled = false;
            }, 2000);
        });
    </script>
</body>

</html>